<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script src="fabric-js.min.js"></script>

<dom-module id="fabric-js">
    <template>
        <style is="custom-style" include="shared-styles iron-flex iron-flex-alignment">
            :host {
                @apply(--layout-fit);
                @apply(--layout-horizontal);
                overflow: auto;
                padding-top: 64px;
            }
        </style>

        <canvas id="c" style="border: 1px solid black;"></canvas>

    </template>

    <script>
        (function () {
            'use strict';

            var canvas;

            Polymer({
                is: 'fabric-js',
                properties: {
                    imageData: {
                        type: Object,
                        reflectToAttribute: true,
                        notify: true
                    },
                    sRate: {
                        type: Number,
                        notify: true,
                        value: 0
                    },
                    dRate: {
                        type: Number,
                        notify: true,
                        value: 0
                    },
                    oRate: {
                        type: Number,
                        notify: true,
                        value: 0
                    },
                    generatedImage: {
                        type: String,
                        notify: true,
                        reflectToAttribute: true
                    }
                },
                _generateRectangle: function(height, width, top) {
                    height = 0.15 * height;
                    var rect = new fabric.Rect({
                        width: width,
                        height: height,
                        fill: 'white',
                        top: top
                    });
                    return rect;
                },
                _generateText: function(top, height) {
                    var str = 'S: ' + this.sRate + ' D: ' + this.dRate + ' O: ' + this.oRate;
                    var text = new fabric.Text(str, {
                        top: top + 20,
                        fontSize: 20,
                        left: 30
                    });
                    return text;
                },
                generateImage: function() {
                    var viewportWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
                    var viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
                    var canvas = new fabric.StaticCanvas('c');

                    canvas.setDimensions({
                        width: viewportWidth - (0.01 * viewportWidth),
                        height: viewportHeight - (0.15 * viewportHeight)
                    });

                    var imageHeight;
                    fabric.Image.fromURL(this.imageData, function(oImg) {
                        oImg.scale(1);
                        oImg.setWidth(canvas.width);
                        // console.log(oImg);
                        imageHeight = oImg.height;
                        canvas.add(oImg);
                        canvas.add(this._generateRectangle(canvas.height, canvas.width, imageHeight));
                        canvas.add(this._generateText(imageHeight, canvas.height));
                        this.generatedImage = canvas.toDataURL();
                    }.bind(this));
                }
            });
        })();
    </script>
</dom-module>
