<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/google-signin/google-signin.html">

<link rel="import" href="shared-styles.html">

<dom-module id="profile-view">
    <template>
        <style include="shared-styles">
            :host {
                display: block;
                padding: 10px;
            }
        </style>

        <google-signin 
            theme="dark" 
            client-id="867389108662-ml3u1clb60k7oqam0bcai4bt207u88j0.apps.googleusercontent.com" 
            scopes="https://www.googleapis.com/auth/drive"
            signed-in="{{signedIn}}">
        </google-signin>
        
    </template>

    <script>
        (function(){
            Polymer({
                is: 'profile-view',
                properties: {
                    activeRoute: {
                        type: String,
                        reflectToAttribute: true,
                        observer: '_activeRoute'
                    },
                    signedIn: {
                        type: Boolean,
                        notify: true,
                        observer: '_userObserver'
                    }
                },
                listeners: {
                    'google-signin-success' : '_googleSignInSuccess' 
                },
                _googleSignInSuccess: function() {
                    document.querySelector('my-app').storeUser(gapi.auth2.getAuthInstance()['currentUser'].get());
                    document.querySelector('my-app').setUser();
                    document.querySelector('my-app').setAuthToken(gapi.auth2.getAuthInstance()['currentUser'].get().Zi.access_token);
                    console.log(gapi.auth2.getAuthInstance()['currentUser'].get());
                    this._activeRoute();
                },
                _userObserver: function() {
                    if (this.signedIn === false) {
                        document.querySelector('my-app').removeUser();
                    }
                },
                _activeRoute: function (route) {
                    // if (this.signedIn) {
                    //     window.history.pushState({}, null, '/dashboard');
                    //     window.dispatchEvent(new CustomEvent('location-changed'));
                    // }
                    // if(route && route.path && route.path.split('/')[1] === 'login') {
                    //     this.pageName = 'Login';
                    //     document.querySelector('my-app').setClosed();

                    //     this.email = "";
                    //     this.password = "";
                    //     this.forgotEmail = "";
                    //     this.signInErrorMessage = "";
                    //     this.signInErrorInvalid = false;

                    //     // Login
                    //     this.$.submitLogin.url = document.querySelector('my-app').getAuth() + '/oauth/token';
                    //     this.$.submitLogin.headers = {
                    //         'Accept-Language': 'en-US;q=1',
                    //         'Authorization': 'Basic YWRtaW46c29tZXNlY3JldA==',
                    //         'Content-Type': 'application/x-www-form-urlencoded',
                    //         'Accept': 'application/json'
                    //     };

                    //     // Password Reset
                    //     this.$.submitPasswordReset.url = document.querySelector('my-app').getAuth() + '/lostpassword';
                    // }
                }
            });
        })();
    </script>
</dom-module>
